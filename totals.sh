jq -r 'group_by(.transactionDate | split(".")[0] | "\(.)Z" | fromdate | gmtime | .[0:2]) | [.[] | {date: .[0].transactionDate | split(".")[0] | "\(.)Z" | fromdate | gmtime | .[0:2] , totalAmount: [.[].transactionAmount] | add}] | .[].date[1] += 1 | .[].date |= . + [1] | .[].date |= join("-") | (map(keys) | add | unique) as $cols | map(. as $row | $cols | map($row[.])) as $rows | $cols, $rows[] | @csv' transactions-valid.json | tr -d '"' | tee totals.csv
